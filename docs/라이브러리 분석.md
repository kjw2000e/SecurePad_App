# KICASecureKeypad 라이브러리 가이드

AI가 생성한 코드가 복잡해 보여도 걱정하지 마세요! 이 문서는 `kicasecurekeypad` 라이브러리가 어떻게 구성되어 있고, 어떤 원리로 동작하는지 아주 쉽게 설명해 드립니다.

---

## 1. 전체 구조 큰 그림 (Big Picture)

이 라이브러리는 **MVVM (Model - View - ViewModel)** 패턴과 **Jetpack Compose**를 사용하여 만들어졌습니다.

*   **View (화면)**: 사용자가 보는 키패드 화면 (`SecureKeypad.kt`)
*   **ViewModel (두뇌)**: 키패드의 상태 관리 및 로직 처리 (`KeypadViewModel.kt`)
*   **Model/Data (데이터)**: 키 배치 정보, 설정 값 등 (`layout`, `domain/model`)

### 데이터 흐름 (단방향)

1.  **사용자 행동**: 사용자가 '키'를 누릅니다.
2.  **이벤트 전달**: ViewModel에게 "이 키가 눌렸어!"라고 알립니다.
3.  **로직 처리**: ViewModel이 입력값을 저장하거나, 모드를 바꿉니다 (예: 특수문자 토글).
4.  **상태 업데이트**: ViewModel이 "화면을 이렇게 바꿔!"라고 상태(State)를 갱신합니다.
5.  **화면 갱신**: View가 새로운 상태를 감지하고 자동으로 화면을 다시 그립니다.

---

## 2. 주요 파일 설명 (Key Components)

### 2.1. View (화면 그리기)

**`src/main/java/.../SecureKeypad.kt`**
*   가장 중요한 파일입니다. 앱에서 이 컴포저블(`SecureKeypad`)을 불러서 키패드를 화면에 띄웁니다.
*   **핵심 역할**:
    *   `KeypadConfig`에 따라 어떤 키패드(숫자, 영문, 한글)를 보여줄지 결정합니다.
    *   ViewModel의 상태(`keys`, `isSpecialCharMode` 등)를 관찰(Observe)하고 있습니다.
    *   `AlphabeticKeypadLayout`: 영문/한글/특수문자 키패드 모양을 잡는 함수입니다.

### 2.2. ViewModel (로직 담당)

**`src/main/java/.../viewmodel/KeypadViewModel.kt`**
*   키패드의 **두뇌**입니다.
*   **주요 변수**:
    *   `_keys`: 현재 화면에 보여줄 키들의 목록 (예: 'ㄱ', 'ㄴ', 'ㄷ'...).
    *   `_maskedInput`: 사용자가 입력한 값의 마스킹된 버전 (예: `***`).
    *   `_isSpecialCharMode`: 현재 특수문자 모드인지 아닌지 (True/False).
*   **주요 함수**:
    *   `loadKeys()`: 현재 설정(영문/한글/특수문자)에 맞춰서 키 목록을 새로 만듭니다.
    *   `handleKeyPress(key)`: 키가 눌렸을 때 할 일을 정합니다. (글자 입력, 지우기, 완료 등)
    *   `handleSpecialToggle()`: 특수문자 버튼을 눌렀을 때 모드를 바꿉니다.

### 2.3. Layout (키 배치 데이터)

**`src/main/java/.../data/layout/` 폴더**
*   키패드 자판 배열이 정의된 곳입니다. "어떤 위치에 어떤 키가 있어야 하는지"를 알려줍니다.
*   **`EnglishLayout.kt`**: 영문 QWERTY 배열 + 숫자 행.
*   **`KoreanLayout.kt`**: 한글 천지인/2벌식 배열 + 숫자 행.
*   **`SpecialCharLayout.kt`**: 특수문자 배열 (!@#...).
*   **`NumericLayout.kt`**: 보안 숫자 키패드 (랜덤 재배열 기능 포함).

각 파일에는 `getKeys()` 함수가 있어서, 이 함수를 부르면 키 리스트(`List<Key>`)를 줍니다.

### 2.4. Model (데이터 정의)

**`src/main/java/.../domain/model/` 폴더**
*   **`Key.kt`**: 키 하나하나의 정보 (화면에 보일 글자, 실제 값, 타입).
*   **`KeyType.kt`**: 키의 종류 (일반 키, 백스페이스, Shift, 특수문자 토글 등).

---

## 3. 동작 과정 예시 (Process Flow)

### 예시: "특수문자 버튼(!#1)"을 눌렀을 때

1.  **View (`SecureKeypad`)**: 사용자가 `!#1` 버튼을 클릭합니다.
    *   `onClick` 이벤트가 발생하여 `viewModel.handleKeyPress(key)`를 호출합니다.
    *   이때 `key.type`은 `SPECIAL_TOGGLE`입니다.

2.  **ViewModel (`KeypadViewModel`)**:
    *   `handleKeyPress` 함수가 키 타입을 확인하고 `handleSpecialToggle()`을 실행합니다.
    *   `_isSpecialCharMode` 값을 `true`로 바꿉니다.
    *   `loadKeys()`를 호출합니다.

3.  **ViewModel (`loadKeys`)**:
    *   "어? 특수문자 모드네?"라고 판단합니다.
    *   `SpecialCharLayout.getKeys()`를 호출하여 **특수문자 키 목록**을 가져옵니다.
    *   `_keys` (상태)를 새로운 특수문자 목록으로 업데이트합니다.

4.  **View (`SecureKeypad`)**:
    *   `keys`와 `isSpecialCharMode` 상태가 변한 것을 감지합니다.
    *   `AlphabeticKeypadLayout`에게 "특수문자 레이아웃(4줄)으로 다시 그려!"라고 시킵니다.
    *   화면이 짠! 하고 바뀝니다.

---

## 4. 커스터마이징 팁

*   **키 배열을 바꾸고 싶다면?**
    *   `data/layout/` 폴더에 있는 파일을 수정하세요. `getKeys()` 안의 리스트 순서를 바꾸면 됩니다.
*   **디자인(색상)을 바꾸고 싶다면?**
    *   `KeypadConfig`를 생성할 때 `colors` 파라미터에 원하는 색상을 넣으세요.
*   **새로운 기능 키를 추가하고 싶다면?**
    1.  `KeyType.kt`에 새 타입을 추가합니다.
    2.  `Layout` 파일에 해당 키를 추가합니다.
    3.  `KeypadViewModel.kt`의 `handleKeyPress`에 동작을 추가합니다.

이 가이드가 라이브러리 이해에 도움이 되기를 바랍니다! 😊
