# 보안 키패드 라이브러리 프로젝트 설계서
> KICA Secure Keypad Library - Production Ready Design Document

## 목차
1. [프로젝트 개요](#1-프로젝트-개요)
2. [기술 스택](#2-기술-스택)
3. [환경 설정](#3-환경-설정)
4. [보안 요구사항](#4-보안-요구사항)
5. [아키텍처 설계](#5-아키텍처-설계)
6. [Public API 설계](#6-public-api-설계)
7. [기능 명세](#7-기능-명세)
8. [암호화 구현](#8-암호화-구현)
9. [성능 요구사항](#9-성능-요구사항)
10. [테스트 전략](#10-테스트-전략)
11. [접근성](#11-접근성)
12. [에러 처리](#12-에러-처리)
13. [개발 일정](#13-개발-일정)
14. [배포 전략](#14-배포-전략)
15. [리스크 관리](#15-리스크-관리)

---

## 1. 프로젝트 개요

### 1.1 목적
금융 앱, 인증 앱 등에서 사용할 수 있는 **재사용 가능한 보안 키패드 Android 라이브러리** 개발

### 1.2 핵심 목표
- ✅ **보안성**: 키로깅, 스크린샷, 메모리 덤프 공격 방어
- ✅ **재사용성**: 어떤 앱에서든 쉽게 통합 가능한 라이브러리
- ✅ **커스터마이징**: 테마, 색상, 레이아웃 자유로운 변경
- ✅ **성능**: 부드러운 키 입력 경험 (< 100ms 반응 시간)
- ✅ **접근성**: TalkBack 등 접근성 기능 지원

### 1.3 범위
- **Phase 1 (MVP)**: 숫자 키패드 + 기본 보안 기능
- **Phase 2**: 영문/한글 키패드 + 고급 보안
- **Phase 3**: 레이아웃 랜덤화, 생체인증 연동

---

## 2. 기술 스택

### 2.1 핵심 기술
| 기술 | 버전 | 용도 |
|------|------|------|
| Kotlin | 2.0.21 | 언어 |
| Jetpack Compose | 1.7.x | UI 프레임워크 |
| Compose BOM | 2024.12.01 | 버전 관리 |
| ViewModel | 2.8.x | 상태 관리 |
| Coroutines | 1.9.x | 비동기 처리 |
| Android Keystore | - | 암호화 키 관리 |

### 2.2 Compose 선택 이유
✅ **커스텀 UI 최적화**: 키패드는 커스텀 뷰가 핵심 → Compose가 XML보다 3배 이상 간결
✅ **테마 변경 용이**: MaterialTheme으로 즉시 대응
✅ **상태 관리 명확**: remember, State로 예측 가능한 UI
✅ **미래 지향적**: 2025년 표준 기술
✅ **성능**: Recomposition 최적화로 부드러운 애니메이션

### 2.3 최소 요구사항
- **minSdk**: 29 (Android 10)
- **targetSdk**: 36 (Android 15)
- **compileSdk**: 36
- **Java**: 11

---

## 3. 환경 설정

### 3.1 libs.versions.toml
```toml
[versions]
agp = "8.13.0-rc02"
kotlin = "2.0.21"
compose-bom = "2024.12.01"
compose-compiler = "1.5.15"
lifecycle = "2.8.7"
coroutines = "1.9.0"
security-crypto = "1.1.0-alpha06"
coreKtx = "1.17.0"
appcompat = "1.7.1"
material = "1.13.0"

# Testing
junit = "4.13.2"
androidx-test-junit = "1.3.0"
espresso = "3.7.0"
compose-ui-test = "1.7.6"
mockk = "1.13.14"
turbine = "1.2.0"

[libraries]
# Compose
compose-bom = { group = "androidx.compose", name = "compose-bom", version.ref = "compose-bom" }
compose-ui = { group = "androidx.compose.ui", name = "ui" }
compose-ui-graphics = { group = "androidx.compose.ui", name = "ui-graphics" }
compose-ui-tooling = { group = "androidx.compose.ui", name = "ui-tooling" }
compose-ui-tooling-preview = { group = "androidx.compose.ui", name = "ui-tooling-preview" }
compose-material3 = { group = "androidx.compose.material3", name = "material3" }
compose-runtime = { group = "androidx.compose.runtime", name = "runtime" }
compose-foundation = { group = "androidx.compose.foundation", name = "foundation" }

# Lifecycle
lifecycle-runtime-ktx = { group = "androidx.lifecycle", name = "lifecycle-runtime-ktx", version.ref = "lifecycle" }
lifecycle-viewmodel-compose = { group = "androidx.lifecycle", name = "lifecycle-viewmodel-compose", version.ref = "lifecycle" }
lifecycle-runtime-compose = { group = "androidx.lifecycle", name = "lifecycle-runtime-compose", version.ref = "lifecycle" }

# Coroutines
kotlinx-coroutines-core = { group = "org.jetbrains.kotlinx", name = "kotlinx-coroutines-core", version.ref = "coroutines" }
kotlinx-coroutines-android = { group = "org.jetbrains.kotlinx", name = "kotlinx-coroutines-android", version.ref = "coroutines" }

# Security
security-crypto = { group = "androidx.security", name = "security-crypto", version.ref = "security-crypto" }

# Android
androidx-core-ktx = { group = "androidx.core", name = "core-ktx", version.ref = "coreKtx" }
androidx-appcompat = { group = "androidx.appcompat", name = "appcompat", version.ref = "appcompat" }
material = { group = "com.google.android.material", name = "material", version.ref = "material" }

# Testing
junit = { group = "junit", name = "junit", version.ref = "junit" }
androidx-junit = { group = "androidx.test.ext", name = "junit", version.ref = "androidx-test-junit" }
androidx-espresso-core = { group = "androidx.test.espresso", name = "espresso-core", version.ref = "espresso" }
compose-ui-test-junit4 = { group = "androidx.compose.ui", name = "ui-test-junit4", version.ref = "compose-ui-test" }
compose-ui-test-manifest = { group = "androidx.compose.ui", name = "ui-test-manifest", version.ref = "compose-ui-test" }
mockk = { group = "io.mockk", name = "mockk", version.ref = "mockk" }
turbine = { group = "app.cash.turbine", name = "turbine", version.ref = "turbine" }
kotlinx-coroutines-test = { group = "org.jetbrains.kotlinx", name = "kotlinx-coroutines-test", version.ref = "coroutines" }

[plugins]
android-application = { id = "com.android.application", version.ref = "agp" }
android-library = { id = "com.android.library", version.ref = "agp" }
kotlin-android = { id = "org.jetbrains.kotlin.android", version.ref = "kotlin" }
kotlin-compose = { id = "org.jetbrains.kotlin.plugin.compose", version.ref = "kotlin" }
```

### 3.2 kicasecurekeypad/build.gradle.kts
```kotlin
plugins {
    alias(libs.plugins.android.library)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.kotlin.compose)
    id("maven-publish")
}

android {
    namespace = "com.kica.android.secure.keypad"
    compileSdk = 36

    defaultConfig {
        minSdk = 29
        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"

        consumerProguardFiles("consumer-rules.pro")
    }

    buildTypes {
        release {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }

    buildFeatures {
        compose = true
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }

    kotlinOptions {
        jvmTarget = "11"
    }
}

dependencies {
    // Compose BOM
    val composeBom = platform(libs.compose.bom)
    implementation(composeBom)
    androidTestImplementation(composeBom)

    // Compose
    implementation(libs.compose.ui)
    implementation(libs.compose.ui.graphics)
    implementation(libs.compose.ui.tooling.preview)
    implementation(libs.compose.material3)
    implementation(libs.compose.runtime)
    implementation(libs.compose.foundation)
    debugImplementation(libs.compose.ui.tooling)

    // Lifecycle
    implementation(libs.lifecycle.runtime.ktx)
    implementation(libs.lifecycle.viewmodel.compose)
    implementation(libs.lifecycle.runtime.compose)

    // Coroutines
    implementation(libs.kotlinx.coroutines.core)
    implementation(libs.kotlinx.coroutines.android)

    // Security
    implementation(libs.security.crypto)

    // Android
    implementation(libs.androidx.core.ktx)

    // Testing
    testImplementation(libs.junit)
    testImplementation(libs.mockk)
    testImplementation(libs.turbine)
    testImplementation(libs.kotlinx.coroutines.test)

    androidTestImplementation(libs.androidx.junit)
    androidTestImplementation(libs.androidx.espresso.core)
    androidTestImplementation(libs.compose.ui.test.junit4)
    debugImplementation(libs.compose.ui.test.manifest)
}

// Maven publishing configuration
publishing {
    publications {
        register<MavenPublication>("release") {
            groupId = "com.kica.android"
            artifactId = "secure-keypad"
            version = "1.0.0"

            afterEvaluate {
                from(components["release"])
            }
        }
    }
}
```

### 3.3 Proguard 규칙 (proguard-rules.pro)
```proguard
# Keep all public API
-keep public class com.kica.android.secure.keypad.** {
    public protected *;
}

# Keep Compose
-dontwarn androidx.compose.**
-keep class androidx.compose.** { *; }

# Keep ViewModel
-keep class * extends androidx.lifecycle.ViewModel {
    <init>();
}

# Keep security classes
-keep class com.kica.android.secure.keypad.security.** { *; }

# Optimize but keep security
-optimizations !code/simplification/arithmetic,!code/simplification/cast,!field/*,!class/merging/*
```

---

## 4. 보안 요구사항

### 4.1 핵심 보안 기능

#### 4.1.1 스크린샷 방지
```kotlin
// Activity/Fragment에서 사용
window.setFlags(
    WindowManager.LayoutParams.FLAG_SECURE,
    WindowManager.LayoutParams.FLAG_SECURE
)
```

#### 4.1.2 메모리 보안
- **즉시 암호화**: 키 입력 즉시 AES-256으로 암호화
- **메모리 제로화**: 사용 후 즉시 `Arrays.fill(data, 0)` 실행
- **SecureString 사용**: Char 배열로 관리, String 회피

```kotlin
class SecureBuffer {
    private val encryptedData = mutableListOf<ByteArray>()

    fun add(char: Char) {
        val encrypted = encrypt(char)
        encryptedData.add(encrypted)
        // 원본 제로화
    }

    fun clear() {
        encryptedData.forEach { it.fill(0) }
        encryptedData.clear()
    }
}
```

#### 4.1.3 키로깅 방지
- **커스텀 뷰 사용**: EditText 회피, 직접 그리기
- **InputConnection 비활성화**: 시스템 키보드 차단
- **오버레이 감지**: `onFilterTouchEventForSecurity` 활용

```kotlin
// Compose에서 오버레이 감지
@Composable
fun SecureKeypad(modifier: Modifier = Modifier) {
    val view = LocalView.current

    DisposableEffect(Unit) {
        val listener = View.OnAttachStateChangeListener {
            if (view.hasWindowFocus()) {
                // 안전한 상태
            }
        }
        view.addOnAttachStateChangeListener(listener)

        onDispose {
            view.removeOnAttachStateChangeListener(listener)
        }
    }

    // UI 구현
}
```

#### 4.1.4 난독화
- **Proguard/R8**: Release 빌드에서 코드 난독화
- **리플렉션 방지**: 핵심 암호화 로직 보호
- **네이티브 코드 고려**: Phase 3에서 JNI로 암호화 로직 이전

### 4.2 선택적 보안 기능 (Phase 2+)

#### 4.2.1 키패드 레이아웃 랜덤화
```kotlin
data class KeypadConfig(
    val randomizeLayout: Boolean = false,
    val randomSeed: Long? = null
)

fun getRandomizedLayout(): List<Key> {
    val keys = listOf("0", "1", "2", "3", "4", "5", "6", "7", "8", "9")
    return if (config.randomizeLayout) {
        keys.shuffled(Random(config.randomSeed ?: System.currentTimeMillis()))
    } else {
        keys
    }
}
```

#### 4.2.2 입력 타이머
```kotlin
// 일정 시간 후 자동 초기화
LaunchedEffect(lastInputTime) {
    delay(30_000) // 30초
    viewModel.clearInput()
}
```

### 4.3 보안 체크리스트

- [ ] 스크린샷 방지 적용
- [ ] 메모리 덤프 시 암호화된 데이터만 노출
- [ ] 로그에 입력값 출력 금지
- [ ] 디버그 빌드와 릴리즈 빌드 분리
- [ ] Proguard 적용 및 검증
- [ ] SSL Pinning (서버 전송 시)
- [ ] 루팅/탈옥 탐지 (선택사항)

---

## 5. 아키텍처 설계

### 5.1 모듈 구조
```
kicasecurekeypad/
├── src/
│   ├── main/
│   │   ├── java/com/kica/android/secure/keypad/
│   │   │   ├── ui/
│   │   │   │   ├── SecureKeypad.kt          # 메인 Composable (Public API)
│   │   │   │   ├── KeypadButton.kt          # 개별 키 버튼
│   │   │   │   ├── KeypadGrid.kt            # 그리드 레이아웃
│   │   │   │   ├── InputDisplay.kt          # 입력 표시 영역
│   │   │   │   └── theme/
│   │   │   │       ├── KeypadTheme.kt       # Material3 커스텀 테마
│   │   │   │       ├── Color.kt             # 색상 정의
│   │   │   │       └── Shape.kt             # 모양 정의
│   │   │   │
│   │   │   ├── viewmodel/
│   │   │   │   └── KeypadViewModel.kt       # UI 상태 관리
│   │   │   │
│   │   │   ├── domain/
│   │   │   │   ├── model/
│   │   │   │   │   ├── Key.kt               # 키 데이터 모델
│   │   │   │   │   ├── KeyType.kt           # 키 타입 Enum
│   │   │   │   │   ├── KeypadType.kt        # 키패드 타입 Enum
│   │   │   │   │   └── KeypadConfig.kt      # 설정 객체
│   │   │   │   │
│   │   │   │   └── usecase/
│   │   │   │       ├── GetLayoutUseCase.kt  # 레이아웃 생성
│   │   │   │       └── ValidateInputUseCase.kt # 입력 검증
│   │   │   │
│   │   │   ├── data/
│   │   │   │   ├── repository/
│   │   │   │   │   └── KeypadLayoutRepository.kt  # 레이아웃 관리
│   │   │   │   │
│   │   │   │   └── layout/
│   │   │   │       ├── NumericLayout.kt     # 숫자 레이아웃
│   │   │   │       ├── EnglishLayout.kt     # 영문 레이아웃
│   │   │   │       └── KoreanLayout.kt      # 한글 레이아웃
│   │   │   │
│   │   │   ├── security/
│   │   │   │   ├── SecureBuffer.kt          # 암호화 버퍼
│   │   │   │   ├── CryptoManager.kt         # 암호화 관리자
│   │   │   │   └── KeystoreHelper.kt        # Android Keystore 헬퍼
│   │   │   │
│   │   │   └── util/
│   │   │       ├── KeypadLogger.kt          # 안전한 로깅
│   │   │       └── Extensions.kt            # 확장 함수
│   │   │
│   │   └── AndroidManifest.xml
│   │
│   ├── test/
│   │   └── java/com/kica/android/secure/keypad/
│   │       ├── viewmodel/
│   │       │   └── KeypadViewModelTest.kt
│   │       ├── security/
│   │       │   ├── SecureBufferTest.kt
│   │       │   └── CryptoManagerTest.kt
│   │       └── domain/
│   │           └── GetLayoutUseCaseTest.kt
│   │
│   └── androidTest/
│       └── java/com/kica/android/secure/keypad/
│           └── ui/
│               └── SecureKeypadTest.kt
│
└── build.gradle.kts
```

### 5.2 아키텍처 패턴
- **MVVM**: ViewModel + Compose State
- **Clean Architecture**: Domain, Data, Presentation 계층 분리
- **Single Source of Truth**: ViewModel이 상태 관리
- **Unidirectional Data Flow**: UI → ViewModel → State → UI

### 5.3 계층별 책임

#### Presentation (UI)
- Composable 함수로 UI 렌더링
- 사용자 입력 이벤트 수집
- ViewModel의 State 관찰

#### Domain
- 비즈니스 로직 (레이아웃 생성, 입력 검증)
- Use Case로 캡슐화
- 플랫폼 독립적

#### Data
- 레이아웃 데이터 제공
- 영속성 필요시 Repository 패턴

#### Security
- 암호화/복호화
- 키 관리
- 메모리 보안

---

## 6. Public API 설계

### 6.1 주요 Composable

#### SecureKeypad (Main Entry Point)
```kotlin
/**
 * 보안 키패드 Composable
 *
 * @param modifier Modifier
 * @param config 키패드 설정
 * @param onKeyPressed 키 입력 콜백 (마스킹된 값 전달)
 * @param onComplete 완료 버튼 클릭 콜백
 * @param onError 에러 발생 콜백
 */
@Composable
fun SecureKeypad(
    modifier: Modifier = Modifier,
    config: KeypadConfig = KeypadConfig(),
    onKeyPressed: (maskedValue: String) -> Unit = {},
    onComplete: (SecureResult) -> Unit = {},
    onError: (KeypadError) -> Unit = {}
)
```

### 6.2 설정 객체

#### KeypadConfig
```kotlin
/**
 * 키패드 설정
 */
data class KeypadConfig(
    /** 키패드 타입 */
    val type: KeypadType = KeypadType.NUMERIC,

    /** 색상 테마 */
    val colors: KeypadColors = KeypadColors.default(),

    /** 마스킹 문자 */
    val maskingChar: Char = '●',

    /** 최대 입력 길이 (null이면 무제한) */
    val maxLength: Int? = null,

    /** 키패드 레이아웃 랜덤화 */
    val randomizeLayout: Boolean = false,

    /** 자동 초기화 시간 (ms, null이면 비활성화) */
    val autoResetTimeout: Long? = null,

    /** 진동 피드백 활성화 */
    val enableHapticFeedback: Boolean = true,

    /** 사운드 피드백 활성화 */
    val enableSoundFeedback: Boolean = false,

    /** 접근성 활성화 */
    val enableAccessibility: Boolean = true
)

/**
 * 키패드 타입
 */
enum class KeypadType {
    NUMERIC,    // 숫자만 (0-9)
    ENGLISH,    // 영문 QWERTY
    KOREAN,     // 한글 (천지인)
    ALPHANUMERIC // 영문 + 숫자
}

/**
 * 색상 설정
 */
data class KeypadColors(
    val backgroundColor: Color,
    val keyBackgroundColor: Color,
    val keyTextColor: Color,
    val specialKeyBackgroundColor: Color,
    val specialKeyTextColor: Color,
    val inputDisplayBackgroundColor: Color,
    val inputDisplayTextColor: Color
) {
    companion object {
        fun default() = KeypadColors(
            backgroundColor = Color(0xFFF5F5F5),
            keyBackgroundColor = Color.White,
            keyTextColor = Color(0xFF212121),
            specialKeyBackgroundColor = Color(0xFF1976D2),
            specialKeyTextColor = Color.White,
            inputDisplayBackgroundColor = Color.White,
            inputDisplayTextColor = Color(0xFF212121)
        )

        fun dark() = KeypadColors(
            backgroundColor = Color(0xFF121212),
            keyBackgroundColor = Color(0xFF1E1E1E),
            keyTextColor = Color(0xFFE0E0E0),
            specialKeyBackgroundColor = Color(0xFF2196F3),
            specialKeyTextColor = Color.White,
            inputDisplayBackgroundColor = Color(0xFF1E1E1E),
            inputDisplayTextColor = Color(0xFFE0E0E0)
        )
    }
}
```

### 6.3 콜백 데이터 모델

#### SecureResult
```kotlin
/**
 * 보안 입력 결과
 */
sealed class SecureResult {
    /**
     * 성공
     * @param secureBuffer 암호화된 입력 데이터
     */
    data class Success(val secureBuffer: SecureBuffer) : SecureResult()

    /**
     * 취소
     */
    data object Cancelled : SecureResult()
}

/**
 * 에러 타입
 */
sealed class KeypadError {
    /** 최대 길이 초과 */
    data object MaxLengthExceeded : KeypadError()

    /** 암호화 실패 */
    data class EncryptionFailed(val cause: Throwable) : KeypadError()

    /** 메모리 부족 */
    data object OutOfMemory : KeypadError()

    /** 일반 에러 */
    data class Unknown(val message: String) : KeypadError()
}
```

### 6.4 보안 버퍼 API

#### SecureBuffer
```kotlin
/**
 * 암호화된 입력 버퍼
 *
 * 사용 후 반드시 clear() 호출 필요
 */
interface SecureBuffer {
    /**
     * 복호화된 문자열 가져오기
     * 주의: 사용 후 즉시 제로화 권장
     */
    fun getDecrypted(): CharArray

    /**
     * 입력 길이
     */
    fun length(): Int

    /**
     * 버퍼 비우기 및 메모리 제로화
     */
    fun clear()

    /**
     * 버퍼가 비어있는지
     */
    fun isEmpty(): Boolean
}
```

### 6.5 사용 예제

#### 기본 사용법
```kotlin
@Composable
fun LoginScreen() {
    var showKeypad by remember { mutableStateOf(false) }
    var maskedPassword by remember { mutableStateOf("") }

    Column {
        // 비밀번호 표시 영역
        Text(
            text = maskedPassword.ifEmpty { "비밀번호 입력" },
            modifier = Modifier
                .fillMaxWidth()
                .clickable { showKeypad = true }
        )

        // 보안 키패드
        if (showKeypad) {
            SecureKeypad(
                config = KeypadConfig(
                    type = KeypadType.NUMERIC,
                    maxLength = 6
                ),
                onKeyPressed = { masked ->
                    maskedPassword = masked
                },
                onComplete = { result ->
                    when (result) {
                        is SecureResult.Success -> {
                            // 서버로 전송
                            val password = result.secureBuffer.getDecrypted()
                            sendToServer(password)
                            result.secureBuffer.clear()

                            showKeypad = false
                        }
                        SecureResult.Cancelled -> {
                            showKeypad = false
                        }
                    }
                },
                onError = { error ->
                    when (error) {
                        KeypadError.MaxLengthExceeded -> {
                            Toast.makeText(context, "최대 6자리", Toast.LENGTH_SHORT).show()
                        }
                        else -> {
                            // 에러 처리
                        }
                    }
                }
            )
        }
    }
}
```

#### 커스텀 테마 사용
```kotlin
SecureKeypad(
    config = KeypadConfig(
        type = KeypadType.NUMERIC,
        colors = KeypadColors.dark(),
        maskingChar = '*',
        randomizeLayout = true,
        enableHapticFeedback = true
    ),
    onComplete = { result ->
        // 처리
    }
)
```

#### 다중 언어 키패드
```kotlin
var currentType by remember { mutableStateOf(KeypadType.ENGLISH) }

SecureKeypad(
    config = KeypadConfig(
        type = currentType
    ),
    onKeyPressed = { masked ->
        // 언어 전환 키 처리
    },
    onComplete = { result ->
        // 처리
    }
)
```

---

## 7. 기능 명세

### 7.1 Phase 1: 숫자 키패드 (MVP)

#### 레이아웃
```
┌─────┬─────┬─────┐
│  1  │  2  │  3  │
├─────┼─────┼─────┤
│  4  │  5  │  6  │
├─────┼─────┼─────┤
│  7  │  8  │  9  │
├─────┼─────┼─────┤
│  ⌫  │  0  │  ✓  │
└─────┴─────┴─────┘
```

#### 기능
- ✅ 숫자 입력 (0-9)
- ✅ 백스페이스
- ✅ 완료 버튼
- ✅ 입력 마스킹 (●●●)
- ✅ 진동 피드백
- ✅ 라이트/다크 테마

### 7.2 Phase 2: 영문 키패드

#### 레이아웃 (QWERTY)
```
┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐
│ Q │ W │ E │ R │ T │ Y │ U │ I │ O │ P │
├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
│ A │ S │ D │ F │ G │ H │ J │ K │ L │   │
├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
│ ⇧ │ Z │ X │ C │ V │ B │ N │ M │ ⌫ │   │
├───┴───┴───┴───┴───┴───┴───┴───┴───┴───┤
│     한/영     │      Space      │  ✓  │
└───────────────┴─────────────────┴─────┘
```

#### 기능
- ✅ 영문 입력 (대소문자 전환)
- ✅ 스페이스
- ✅ 언어 전환 (한/영)

### 7.3 Phase 3: 한글 키패드

#### 레이아웃 (천지인 간소화)
```
┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐
│ ㅂ │ ㅈ │ ㄷ │ ㄱ │ ㅅ │ ㅛ │ ㅕ │ ㅑ │ ㅐ │ ㅔ │
├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
│ ㅁ │ ㄴ │ ㅇ │ ㄹ │ ㅎ │ ㅗ │ ㅓ │ ㅏ │ ㅣ │   │
├───┼───┼───┼───┼───┼───┼───┼───┼───┼───┤
│ ⇧ │ ㅋ │ ㅌ │ ㅊ │ ㅍ │ ㅠ │ ㅜ │ ㅡ │ ⌫ │   │
├───┴───┴───┴───┴───┴───┴───┴───┴───┴───┤
│     한/영     │      Space      │  ✓  │
└───────────────┴─────────────────┴─────┘
```

#### 기능
- ✅ 한글 조합 (초성+중성+종성)
- ✅ 자동 조합
- 참고: Phase 1에서는 조합 없이 완성형만 지원 가능

---

## 8. 암호화 구현

### 8.1 암호화 스펙
- **알고리즘**: AES-256-GCM
- **키 관리**: Android Keystore System
- **키 생성**: 앱 최초 실행 시 생성, 하드웨어 보안 모듈(TEE) 저장
- **IV**: 매 암호화마다 랜덤 생성

### 8.2 CryptoManager 구현

```kotlin
/**
 * 암호화 관리자
 * Android Keystore를 사용한 AES-256-GCM 암호화
 */
class CryptoManager(private val context: Context) {

    private val keyStore: KeyStore = KeyStore.getInstance("AndroidKeyStore").apply {
        load(null)
    }

    companion object {
        private const val KEY_ALIAS = "kica_secure_keypad_key"
        private const val TRANSFORMATION = "AES/GCM/NoPadding"
        private const val IV_SIZE = 12 // GCM 표준
    }

    init {
        if (!keyStore.containsAlias(KEY_ALIAS)) {
            generateKey()
        }
    }

    /**
     * AES 키 생성
     */
    private fun generateKey() {
        val keyGenerator = KeyGenerator.getInstance(
            KeyProperties.KEY_ALGORITHM_AES,
            "AndroidKeyStore"
        )

        val keyGenParameterSpec = KeyGenParameterSpec.Builder(
            KEY_ALIAS,
            KeyProperties.PURPOSE_ENCRYPT or KeyProperties.PURPOSE_DECRYPT
        )
            .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
            .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
            .setKeySize(256)
            .setUserAuthenticationRequired(false) // 생체인증 필요시 true
            .setRandomizedEncryptionRequired(true)
            .build()

        keyGenerator.init(keyGenParameterSpec)
        keyGenerator.generateKey()
    }

    /**
     * 암호화
     * @return Pair(IV, 암호화된 데이터)
     */
    fun encrypt(plaintext: CharArray): EncryptedData {
        val cipher = Cipher.getInstance(TRANSFORMATION)
        val secretKey = keyStore.getKey(KEY_ALIAS, null) as SecretKey

        cipher.init(Cipher.ENCRYPT_MODE, secretKey)

        val iv = cipher.iv
        val ciphertext = cipher.doFinal(plaintext.toByteArray())

        // 원본 제로화
        plaintext.fill(0.toChar())

        return EncryptedData(iv, ciphertext)
    }

    /**
     * 복호화
     */
    fun decrypt(encryptedData: EncryptedData): CharArray {
        val cipher = Cipher.getInstance(TRANSFORMATION)
        val secretKey = keyStore.getKey(KEY_ALIAS, null) as SecretKey

        val gcmSpec = GCMParameterSpec(128, encryptedData.iv)
        cipher.init(Cipher.DECRYPT_MODE, secretKey, gcmSpec)

        val decrypted = cipher.doFinal(encryptedData.ciphertext)
        val result = String(decrypted).toCharArray()

        // 원본 제로화
        decrypted.fill(0)

        return result
    }
}

/**
 * 암호화된 데이터
 */
data class EncryptedData(
    val iv: ByteArray,
    val ciphertext: ByteArray
) {
    fun clear() {
        iv.fill(0)
        ciphertext.fill(0)
    }

    override fun equals(other: Any?): Boolean {
        if (this === other) return true
        if (javaClass != other?.javaClass) return false
        other as EncryptedData
        return iv.contentEquals(other.iv) && ciphertext.contentEquals(other.ciphertext)
    }

    override fun hashCode(): Int {
        var result = iv.contentHashCode()
        result = 31 * result + ciphertext.contentHashCode()
        return result
    }
}
```

### 8.3 SecureBuffer 구현

```kotlin
/**
 * 보안 입력 버퍼
 * 모든 입력을 즉시 암호화하여 메모리 보호
 */
class SecureBufferImpl(
    private val cryptoManager: CryptoManager
) : SecureBuffer {

    private val encryptedChars = mutableListOf<EncryptedData>()

    /**
     * 문자 추가 (즉시 암호화)
     */
    fun add(char: Char) {
        val charArray = charArrayOf(char)
        val encrypted = cryptoManager.encrypt(charArray)
        encryptedChars.add(encrypted)
    }

    /**
     * 마지막 문자 삭제
     */
    fun removeLast() {
        if (encryptedChars.isNotEmpty()) {
            val removed = encryptedChars.removeLast()
            removed.clear()
        }
    }

    /**
     * 복호화된 전체 문자열
     * 주의: 사용 후 즉시 제로화 권장
     */
    override fun getDecrypted(): CharArray {
        val result = CharArray(encryptedChars.size)

        encryptedChars.forEachIndexed { index, encrypted ->
            val decrypted = cryptoManager.decrypt(encrypted)
            result[index] = decrypted[0]
            decrypted.fill(0.toChar())
        }

        return result
    }

    override fun length(): Int = encryptedChars.size

    override fun isEmpty(): Boolean = encryptedChars.isEmpty()

    /**
     * 버퍼 완전 제거
     */
    override fun clear() {
        encryptedChars.forEach { it.clear() }
        encryptedChars.clear()
    }
}
```

### 8.4 메모리 보안 사용 예제

```kotlin
// ✅ 올바른 사용법
val secureBuffer = SecureBufferImpl(cryptoManager)
secureBuffer.add('1')
secureBuffer.add('2')

// 복호화 후 즉시 사용 및 제로화
val decrypted = secureBuffer.getDecrypted()
try {
    sendToServer(decrypted)
} finally {
    decrypted.fill(0.toChar()) // 즉시 제로화
    secureBuffer.clear()
}

// ❌ 잘못된 사용법 (String 변환 금지)
val password = String(secureBuffer.getDecrypted()) // String은 불변이라 제로화 불가!
```

---

## 9. 성능 요구사항

### 9.1 목표 지표

| 항목 | 목표 | 측정 방법 |
|------|------|----------|
| 키 입력 반응 시간 | < 100ms | onClick부터 화면 업데이트까지 |
| 최초 렌더링 시간 | < 200ms | Composition 시작부터 첫 프레임까지 |
| 메모리 사용량 | < 10MB | Android Profiler |
| APK 크기 증가 | < 500KB | 라이브러리 추가 시 |
| Recomposition 횟수 | 최소화 | Layout Inspector |

### 9.2 최적화 전략

#### 9.2.1 Compose Recomposition 최적화
```kotlin
// ✅ remember로 계산 결과 캐싱
@Composable
fun KeypadGrid(keys: List<Key>) {
    val gridLayout = remember(keys) {
        calculateGridLayout(keys) // 재계산 방지
    }

    LazyVerticalGrid(
        columns = GridCells.Fixed(3),
        // ...
    ) {
        items(
            items = keys,
            key = { it.value } // 안정적인 키로 불필요한 recomposition 방지
        ) { key ->
            KeypadButton(key = key)
        }
    }
}

// ✅ derivedStateOf로 계산된 상태 최적화
@Composable
fun InputDisplay(input: List<Char>) {
    val maskedText by remember {
        derivedStateOf { "●".repeat(input.size) }
    }

    Text(text = maskedText)
}
```

#### 9.2.2 암호화 비동기 처리
```kotlin
class KeypadViewModel : ViewModel() {
    private val cryptoDispatcher = Dispatchers.IO.limitedParallelism(1)

    fun handleKeyPress(key: Key) {
        viewModelScope.launch(cryptoDispatcher) {
            secureBuffer.add(key.value[0]) // 백그라운드에서 암호화

            withContext(Dispatchers.Main) {
                updateMaskedDisplay()
            }
        }
    }
}
```

#### 9.2.3 메모리 관리
```kotlin
// ViewModel에서 자동 정리
override fun onCleared() {
    super.onCleared()
    secureBuffer.clear()
    // 모든 암호화 데이터 제거
}

// DisposableEffect로 Composable 해제 시 정리
@Composable
fun SecureKeypad() {
    DisposableEffect(Unit) {
        onDispose {
            viewModel.clearAllData()
        }
    }
}
```

### 9.3 성능 측정 도구
- **Android Profiler**: 메모리, CPU 사용량
- **Layout Inspector**: Recomposition 횟수
- **Macrobenchmark**: 시작 시간, 스크롤 성능
- **Custom Logging**: 키 입력 latency 측정

```kotlin
// 성능 측정 예제
inline fun <T> measurePerformance(tag: String, block: () -> T): T {
    val start = System.nanoTime()
    val result = block()
    val elapsed = (System.nanoTime() - start) / 1_000_000.0
    Log.d("Performance", "$tag: ${elapsed}ms")
    return result
}

// 사용
measurePerformance("KeyPress") {
    viewModel.handleKeyPress(key)
}
```

---

## 10. 테스트 전략

### 10.1 테스트 피라미드

```
       /\
      /UI\         10% - Compose UI Test
     /────\
    /Unit \       70% - Unit Test
   /────────\
  /Integration\   20% - Integration Test
 /────────────\
```

### 10.2 Unit Test (70%)

#### 10.2.1 SecureBuffer 테스트
```kotlin
@Test
fun `add and decrypt should return correct value`() {
    val buffer = SecureBufferImpl(cryptoManager)

    buffer.add('1')
    buffer.add('2')
    buffer.add('3')

    val decrypted = buffer.getDecrypted()

    assertThat(String(decrypted)).isEqualTo("123")
    assertThat(buffer.length()).isEqualTo(3)

    decrypted.fill(0.toChar())
    buffer.clear()
}

@Test
fun `clear should zero out all memory`() {
    val buffer = SecureBufferImpl(cryptoManager)
    buffer.add('X')

    buffer.clear()

    assertThat(buffer.isEmpty()).isTrue()
    assertThat(buffer.length()).isEqualTo(0)
}
```

#### 10.2.2 KeypadViewModel 테스트
```kotlin
@Test
fun `handleKeyPress should update masked input`() = runTest {
    val viewModel = KeypadViewModel(cryptoManager)

    viewModel.handleKeyPress(Key(value = "1", displayText = "1"))

    viewModel.maskedInput.test {
        val emission = awaitItem()
        assertThat(emission).isEqualTo("●")
    }
}

@Test
fun `handleBackspace should remove last character`() = runTest {
    val viewModel = KeypadViewModel(cryptoManager)

    viewModel.handleKeyPress(Key(value = "1", displayText = "1"))
    viewModel.handleKeyPress(Key(value = "2", displayText = "2"))
    viewModel.handleBackspace()

    viewModel.maskedInput.test {
        val emission = awaitItem()
        assertThat(emission).isEqualTo("●")
    }
}
```

#### 10.2.3 CryptoManager 테스트
```kotlin
@Test
fun `encrypt and decrypt should return original value`() {
    val original = "password123".toCharArray()

    val encrypted = cryptoManager.encrypt(original)
    val decrypted = cryptoManager.decrypt(encrypted)

    assertThat(String(decrypted)).isEqualTo("password123")

    encrypted.clear()
    decrypted.fill(0.toChar())
}

@Test
fun `encryption should use different IV each time`() {
    val plaintext = "test".toCharArray()

    val encrypted1 = cryptoManager.encrypt(plaintext.copyOf())
    val encrypted2 = cryptoManager.encrypt(plaintext.copyOf())

    assertThat(encrypted1.iv).isNotEqualTo(encrypted2.iv)
}
```

### 10.3 UI Test (10%)

#### Compose UI Test
```kotlin
@Test
fun numericKeypad_displaysCorrectly() {
    composeTestRule.setContent {
        SecureKeypad(
            config = KeypadConfig(type = KeypadType.NUMERIC)
        )
    }

    // 모든 숫자 키 확인
    for (i in 0..9) {
        composeTestRule
            .onNodeWithText(i.toString())
            .assertIsDisplayed()
    }

    // 백스페이스, 완료 버튼 확인
    composeTestRule.onNodeWithContentDescription("Backspace").assertExists()
    composeTestRule.onNodeWithContentDescription("Complete").assertExists()
}

@Test
fun keyPress_updatesInputDisplay() {
    var maskedValue = ""

    composeTestRule.setContent {
        SecureKeypad(
            config = KeypadConfig(type = KeypadType.NUMERIC),
            onKeyPressed = { maskedValue = it }
        )
    }

    // '1' 클릭
    composeTestRule.onNodeWithText("1").performClick()

    // 마스킹된 값 확인
    assertThat(maskedValue).isEqualTo("●")

    // '2' 클릭
    composeTestRule.onNodeWithText("2").performClick()

    assertThat(maskedValue).isEqualTo("●●")
}

@Test
fun completeButton_triggersCallback() {
    var completed = false

    composeTestRule.setContent {
        SecureKeypad(
            onComplete = { result ->
                completed = true
            }
        )
    }

    composeTestRule.onNodeWithText("1").performClick()
    composeTestRule.onNodeWithContentDescription("Complete").performClick()

    assertThat(completed).isTrue()
}
```

### 10.4 보안 테스트 체크리스트

- [ ] **메모리 덤프 테스트**: 입력 중 메모리 덤프 시 평문 노출 여부
- [ ] **스크린샷 테스트**: FLAG_SECURE 적용 시 스크린샷 차단 확인
- [ ] **로그 테스트**: Logcat에 입력값 출력 여부
- [ ] **Proguard 테스트**: 난독화 후 동작 확인
- [ ] **리플렉션 테스트**: 리플렉션으로 암호화 키 접근 불가 확인
- [ ] **타이밍 공격 테스트**: 암호화 시간이 일정한지 확인

### 10.5 코드 커버리지 목표
- **전체**: 80% 이상
- **보안 관련 코드**: 100% (CryptoManager, SecureBuffer)
- **ViewModel**: 90% 이상
- **UI Composable**: 60% 이상 (manual test 병행)

---

## 11. 접근성

### 11.1 TalkBack 지원

#### contentDescription 추가
```kotlin
@Composable
fun KeypadButton(
    key: Key,
    onClick: () -> Unit
) {
    Button(
        onClick = onClick,
        modifier = Modifier.semantics {
            contentDescription = when (key.type) {
                KeyType.NORMAL -> "숫자 ${key.displayText}"
                KeyType.BACKSPACE -> "삭제"
                KeyType.SPACE -> "스페이스"
                KeyType.COMPLETE -> "완료"
                KeyType.SWITCH -> "언어 전환"
            }
            role = Role.Button
        }
    ) {
        Text(text = key.displayText)
    }
}
```

#### 입력 상태 알림
```kotlin
@Composable
fun InputDisplay(maskedText: String) {
    val announcement = remember(maskedText) {
        if (maskedText.isEmpty()) {
            "입력 없음"
        } else {
            "${maskedText.length}자리 입력됨"
        }
    }

    Text(
        text = maskedText,
        modifier = Modifier.semantics {
            contentDescription = announcement
            liveRegion = LiveRegionMode.Polite
        }
    )
}
```

### 11.2 터치 영역 최소 크기
```kotlin
@Composable
fun KeypadButton(key: Key) {
    Button(
        onClick = { /* ... */ },
        modifier = Modifier
            .size(64.dp) // 최소 48dp 이상
            .padding(4.dp)
    ) {
        Text(text = key.displayText)
    }
}
```

### 11.3 색상 대비
- **WCAG AA 기준**: 최소 4.5:1
- **텍스트 색상**: #212121 (어두운 회색) vs #FFFFFF (흰색) = 16:1
- **버튼 색상**: #1976D2 (파란색) vs #FFFFFF = 4.6:1

---

## 12. 에러 처리

### 12.1 에러 타입별 처리

#### 최대 길이 초과
```kotlin
fun handleKeyPress(key: Key) {
    if (secureBuffer.length() >= config.maxLength ?: Int.MAX_VALUE) {
        _error.emit(KeypadError.MaxLengthExceeded)
        // 진동 피드백 (에러)
        hapticFeedback.performHapticFeedback(HapticFeedbackConstants.REJECT)
        return
    }

    // 정상 처리
}
```

#### 암호화 실패
```kotlin
fun handleKeyPress(key: Key) {
    try {
        secureBuffer.add(key.value[0])
    } catch (e: Exception) {
        KeypadLogger.e("Encryption failed", e)
        _error.emit(KeypadError.EncryptionFailed(e))
    }
}
```

#### 메모리 부족
```kotlin
fun handleKeyPress(key: Key) {
    try {
        secureBuffer.add(key.value[0])
    } catch (e: OutOfMemoryError) {
        KeypadLogger.e("Out of memory", e)
        _error.emit(KeypadError.OutOfMemory)

        // 긴급 정리
        secureBuffer.clear()
        System.gc()
    }
}
```

### 12.2 안전한 로깅
```kotlin
object KeypadLogger {
    private const val TAG = "SecureKeypad"

    fun d(message: String) {
        if (BuildConfig.DEBUG) {
            Log.d(TAG, message)
        }
    }

    fun e(message: String, throwable: Throwable? = null) {
        // 에러는 릴리즈에서도 로깅 (입력값 제외)
        Log.e(TAG, message, throwable)
    }

    // ❌ 절대 사용 금지
    fun logInput(input: String) {
        // 컴파일 에러 발생시키기
        error("Input logging is prohibited for security")
    }
}
```

---

## 13. 개발 일정

### 13.1 전체 일정 (8주, 주말 2시간)

| 주차 | 목표 | 소요 시간 | 결과물 |
|-----|------|----------|--------|
| 1-2 | 환경 설정 & 숫자 키패드 | 4시간 | 동작하는 숫자 키패드 |
| 3-4 | 보안 기능 & 테마 | 4시간 | 암호화 + 테마 전환 |
| 5-6 | 영문/한글 키패드 | 4시간 | 3종 키패드 |
| 7 | 테스트 & 리팩토링 | 2시간 | 안정화 |
| 8 | 문서화 & 배포 | 2시간 | 배포 가능 라이브러리 |

### 13.2 Week 1-2: MVP 구현 (4시간)

#### Day 1 (2시간)
- [x] 프로젝트 구조 생성
- [x] Gradle 설정 (Compose 의존성)
- [ ] `Key`, `KeyType` 데이터 클래스 작성
- [ ] `NumericLayout` 레이아웃 정의
- [ ] `KeypadButton` Composable 작성

#### Day 2 (2시간)
- [ ] `KeypadGrid` Composable 작성
- [ ] `KeypadViewModel` 기본 구현
- [ ] 샘플 앱에서 테스트
- [ ] 진동 피드백 추가

**목표**: 숫자 입력 가능한 기본 키패드

### 13.3 Week 3-4: 보안 & 테마 (4시간)

#### Day 3 (2시간)
- [ ] `CryptoManager` 구현 (Android Keystore)
- [ ] `SecureBuffer` 구현
- [ ] ViewModel에 암호화 연동
- [ ] Unit Test 작성

#### Day 4 (2시간)
- [ ] `KeypadColors` 정의
- [ ] 라이트/다크 테마 구현
- [ ] `KeypadConfig` 설정 객체 작성
- [ ] FLAG_SECURE 적용 예제

**목표**: 보안 기능 + 커스터마이징 가능

### 13.4 Week 5-6: 다중 언어 (4시간)

#### Day 5 (2시간)
- [ ] `EnglishLayout` 구현 (QWERTY)
- [ ] 대소문자 전환 로직
- [ ] 언어 전환 버튼
- [ ] 영문 키패드 UI

#### Day 6 (2시간)
- [ ] `KoreanLayout` 구현 (간소화)
- [ ] 한글 조합 로직 (선택사항)
- [ ] 3종 키패드 전환 테스트
- [ ] UI/UX 개선

**목표**: 3종 키패드 완성

### 13.5 Week 7: 안정화 (2시간)
- [ ] Unit Test 커버리지 80% 달성
- [ ] Compose UI Test 추가
- [ ] 성능 최적화 (Recomposition)
- [ ] 코드 리팩토링
- [ ] KDoc 주석 추가

### 13.6 Week 8: 배포 준비 (2시간)
- [ ] README.md 작성
- [ ] API 문서 생성
- [ ] Maven Local 배포 테스트
- [ ] 샘플 앱 고도화
- [ ] KPI 보고서 작성

---

## 14. 배포 전략

### 14.1 버전 관리 (Semantic Versioning)

```
MAJOR.MINOR.PATCH

1.0.0 - 초기 릴리즈 (숫자 키패드 + 보안)
1.1.0 - 영문 키패드 추가
1.2.0 - 한글 키패드 추가
2.0.0 - API Breaking Change
```

### 14.2 Maven Local 배포

#### build.gradle.kts
```kotlin
publishing {
    publications {
        register<MavenPublication>("release") {
            groupId = "com.kica.android"
            artifactId = "secure-keypad"
            version = "1.0.0"

            afterEvaluate {
                from(components["release"])
            }

            pom {
                name.set("KICA Secure Keypad")
                description.set("A secure keypad library for Android")
                url.set("https://github.com/yourusername/kica-secure-keypad")

                licenses {
                    license {
                        name.set("The Apache License, Version 2.0")
                        url.set("http://www.apache.org/licenses/LICENSE-2.0.txt")
                    }
                }

                developers {
                    developer {
                        id.set("yourname")
                        name.set("Your Name")
                        email.set("your.email@example.com")
                    }
                }
            }
        }
    }

    repositories {
        mavenLocal()
    }
}
```

#### 배포 명령어
```bash
./gradlew :kicasecurekeypad:publishToMavenLocal
```

#### 사용 (다른 프로젝트)
```kotlin
repositories {
    mavenLocal()
}

dependencies {
    implementation("com.kica.android:secure-keypad:1.0.0")
}
```

### 14.3 JitPack 배포 (공개용)

#### build.gradle.kts (root)
```kotlin
plugins {
    id("com.github.dcendents.android-maven") version "2.1"
}

group = "com.github.yourusername"
```

#### GitHub Release
1. GitHub에 태그 생성: `git tag -a v1.0.0 -m "Release 1.0.0"`
2. 푸시: `git push origin v1.0.0`
3. JitPack에서 자동 빌드

#### 사용
```kotlin
repositories {
    maven { url = uri("https://jitpack.io") }
}

dependencies {
    implementation("com.github.yourusername:kica-secure-keypad:1.0.0")
}
```

### 14.4 CHANGELOG 관리

#### CHANGELOG.md
```markdown
# Changelog

## [1.0.0] - 2025-01-15
### Added
- 숫자 키패드 (0-9)
- AES-256-GCM 암호화
- Android Keystore 연동
- 라이트/다크 테마
- 진동 피드백

### Security
- 메모리 제로화
- 스크린샷 방지 (FLAG_SECURE)
- Proguard 난독화

## [Unreleased]
### Planned
- 영문 QWERTY 키패드
- 한글 키패드
- 레이아웃 랜덤화
```

---

## 15. 리스크 관리

### 15.1 리스크 분석

| 리스크 | 확률 | 영향도 | 대응 전략 |
|--------|------|--------|----------|
| Compose 학습 부족 | 중 | 중 | Week 1에 튜토리얼 1시간 투자 |
| 한글 조합 복잡도 | 고 | 중 | Phase 1에서는 완성형만 지원 |
| 암호화 성능 저하 | 중 | 고 | 비동기 처리 + 벤치마크 |
| Android Keystore 호환성 | 저 | 고 | minSdk 29로 제한 |
| 시간 부족 | 중 | 중 | Phase 1만 완성해도 KPI 달성 |
| 보안 취약점 발견 | 저 | 고 | 보안 체크리스트 + 테스트 |

### 15.2 대응 계획

#### Compose 학습
- **시점**: Week 1 시작 전 (주중 저녁 1시간)
- **자료**: Android Developers Compose 기초 코스
- **범위**: Column, Row, Button, remember, State만 학습

#### 한글 입력
- **Plan A**: 완성형 한글 직접 입력 (쉬움)
- **Plan B**: 간단한 조합 (초성+중성만)
- **Plan C**: Phase 3로 미루기

#### 성능 문제
- **모니터링**: Android Profiler로 매 주차 체크
- **목표**: 키 입력 반응 < 100ms 유지
- **대응**: Dispatcher 조정, Recomposition 최소화

#### 시간 부족
- **우선순위**:
  1. 숫자 키패드 + 보안 (MVP)
  2. 테마 커스터마이징
  3. 영문 키패드
  4. 한글 키패드 (선택)

---

## 16. 참고 자료

### 16.1 공식 문서
- [Jetpack Compose 기초](https://developer.android.com/jetpack/compose/tutorial)
- [Android Keystore System](https://developer.android.com/privacy-and-security/keystore)
- [Material Design 3](https://m3.material.io/)

### 16.2 보안 가이드
- [OWASP Mobile Security](https://owasp.org/www-project-mobile-security/)
- [Android Security Best Practices](https://developer.android.com/privacy-and-security/security-tips)

### 16.3 예제 프로젝트
- [Now in Android](https://github.com/android/nowinandroid) - Compose 아키텍처 참고
- [Tivi](https://github.com/chrisbanes/tivi) - MVVM + Compose

---

## 17. 성공 기준 (KPI)

### 17.1 기능 완성도
- [x] ~~라이브러리 모듈 생성~~
- [ ] 숫자 키패드 동작
- [ ] AES-256 암호화 적용
- [ ] 테마 전환 (라이트/다크)
- [ ] 입력 마스킹
- [ ] 진동 피드백
- [ ] 샘플 앱 구현

### 17.2 코드 품질
- [ ] MVVM 패턴 적용
- [ ] Clean Architecture 구조
- [ ] Unit Test 커버리지 80% 이상
- [ ] KDoc 주석 완료
- [ ] Proguard 난독화 적용

### 17.3 보안
- [ ] Android Keystore 사용
- [ ] 메모리 제로화 구현
- [ ] 스크린샷 방지 가이드
- [ ] 보안 체크리스트 통과

### 17.4 문서화
- [ ] README.md 작성
- [ ] API 문서 생성
- [ ] 사용 예제 3개 이상
- [ ] CHANGELOG 작성

### 17.5 배포
- [ ] Maven Local 배포 성공
- [ ] 샘플 앱에서 통합 테스트
- [ ] 버전 1.0.0 릴리즈

---

## 18. 다음 스텝

### 18.1 이번 주말 (2시간) 할 일

#### 1단계: 환경 설정 (30분)
- [ ] libs.versions.toml에 Compose 의존성 추가
- [ ] kicasecurekeypad/build.gradle.kts 업데이트
- [ ] Sync Gradle
- [ ] 빌드 확인

#### 2단계: 데이터 모델 작성 (30분)
```kotlin
// Key.kt
data class Key(
    val value: String,
    val displayText: String,
    val type: KeyType = KeyType.NORMAL
)

enum class KeyType {
    NORMAL, BACKSPACE, COMPLETE
}

// NumericLayout.kt
object NumericLayout {
    fun getKeys(): List<Key> = listOf(
        Key("1", "1"), Key("2", "2"), Key("3", "3"),
        Key("4", "4"), Key("5", "5"), Key("6", "6"),
        Key("7", "7"), Key("8", "8"), Key("9", "9"),
        Key("", "⌫", KeyType.BACKSPACE),
        Key("0", "0"),
        Key("", "✓", KeyType.COMPLETE)
    )
}
```

#### 3단계: UI 구현 (60분)
```kotlin
// KeypadButton.kt
@Composable
fun KeypadButton(
    key: Key,
    onClick: () -> Unit,
    modifier: Modifier = Modifier
) {
    Button(
        onClick = onClick,
        modifier = modifier
            .aspectRatio(1f)
            .padding(4.dp)
    ) {
        Text(
            text = key.displayText,
            fontSize = 24.sp
        )
    }
}

// SecureKeypad.kt (간단 버전)
@Composable
fun SecureKeypad(
    modifier: Modifier = Modifier
) {
    val keys = remember { NumericLayout.getKeys() }
    var input by remember { mutableStateOf("") }

    Column(modifier = modifier) {
        // 입력 표시
        Text(
            text = if (input.isEmpty()) "입력 대기" else "●".repeat(input.length),
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            textAlign = TextAlign.Center,
            fontSize = 32.sp
        )

        // 키패드 그리드
        LazyVerticalGrid(
            columns = GridCells.Fixed(3),
            modifier = Modifier.fillMaxWidth()
        ) {
            items(keys) { key ->
                KeypadButton(
                    key = key,
                    onClick = {
                        when (key.type) {
                            KeyType.NORMAL -> input += key.value
                            KeyType.BACKSPACE -> if (input.isNotEmpty()) {
                                input = input.dropLast(1)
                            }
                            KeyType.COMPLETE -> {
                                // TODO: 완료 처리
                            }
                        }
                    }
                )
            }
        }
    }
}
```

### 18.2 완료 확인
이번 주말 목표 달성 시:
- ✅ 숫자 키패드가 화면에 표시됨
- ✅ 버튼 클릭 시 입력됨
- ✅ 백스페이스로 삭제됨
- ✅ 마스킹 (●) 표시됨

**다음 주말**: 암호화 + 테마 적용!

---

## Appendix A: 전체 파일 구조

```
KICASecurePad_App/
├── app/                                    # 샘플 앱
│   ├── src/main/
│   │   ├── java/com/kica/android/secure/keypad/app/
│   │   │   ├── MainActivity.kt
│   │   │   └── LoginScreen.kt
│   │   └── AndroidManifest.xml
│   └── build.gradle.kts
│
├── kicasecurekeypad/                       # 라이브러리 모듈 ⭐
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/com/kica/android/secure/keypad/
│   │   │   │   ├── ui/
│   │   │   │   │   ├── SecureKeypad.kt
│   │   │   │   │   ├── KeypadButton.kt
│   │   │   │   │   ├── KeypadGrid.kt
│   │   │   │   │   ├── InputDisplay.kt
│   │   │   │   │   └── theme/
│   │   │   │   │       ├── KeypadTheme.kt
│   │   │   │   │       ├── Color.kt
│   │   │   │   │       └── Shape.kt
│   │   │   │   ├── viewmodel/
│   │   │   │   │   └── KeypadViewModel.kt
│   │   │   │   ├── domain/
│   │   │   │   │   ├── model/
│   │   │   │   │   │   ├── Key.kt
│   │   │   │   │   │   ├── KeyType.kt
│   │   │   │   │   │   ├── KeypadType.kt
│   │   │   │   │   │   ├── KeypadConfig.kt
│   │   │   │   │   │   ├── KeypadColors.kt
│   │   │   │   │   │   ├── SecureResult.kt
│   │   │   │   │   │   └── KeypadError.kt
│   │   │   │   │   └── usecase/
│   │   │   │   │       ├── GetLayoutUseCase.kt
│   │   │   │   │       └── ValidateInputUseCase.kt
│   │   │   │   ├── data/
│   │   │   │   │   ├── repository/
│   │   │   │   │   │   └── KeypadLayoutRepository.kt
│   │   │   │   │   └── layout/
│   │   │   │   │       ├── NumericLayout.kt
│   │   │   │   │       ├── EnglishLayout.kt
│   │   │   │   │       └── KoreanLayout.kt
│   │   │   │   ├── security/
│   │   │   │   │   ├── SecureBuffer.kt
│   │   │   │   │   ├── SecureBufferImpl.kt
│   │   │   │   │   ├── CryptoManager.kt
│   │   │   │   │   ├── EncryptedData.kt
│   │   │   │   │   └── KeystoreHelper.kt
│   │   │   │   └── util/
│   │   │   │       ├── KeypadLogger.kt
│   │   │   │       └── Extensions.kt
│   │   │   └── AndroidManifest.xml
│   │   ├── test/
│   │   │   └── java/com/kica/android/secure/keypad/
│   │   │       ├── viewmodel/
│   │   │       │   └── KeypadViewModelTest.kt
│   │   │       ├── security/
│   │   │       │   ├── SecureBufferTest.kt
│   │   │       │   └── CryptoManagerTest.kt
│   │   │       └── domain/
│   │   │           └── GetLayoutUseCaseTest.kt
│   │   └── androidTest/
│   │       └── java/com/kica/android/secure/keypad/
│   │           └── ui/
│   │               └── SecureKeypadTest.kt
│   ├── build.gradle.kts
│   ├── proguard-rules.pro
│   ├── consumer-rules.pro
│   └── 251013_보안 키패드 앱 프로젝트 계획서.md  # 이 문서
│
├── gradle/
│   └── libs.versions.toml
├── build.gradle.kts
├── settings.gradle.kts
├── README.md
├── CHANGELOG.md
└── LICENSE
```

---

**작성일**: 2025-01-13
**버전**: 2.0 (대폭 개선)
**작성자**: Claude Code with kjw2000e

---

이제 바로 개발을 시작할 수 있습니다! 🚀
이번 주말에 첫 번째 단계를 완료하시고, 진행 상황을 공유해주세요! 💪
